<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magnetic Field Calculation and Plotting</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .input-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #34495e;
        }
        
        input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .calculate-btn {
            background-color: #3498db;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 20px auto;
            display: block;
        }
        
        .calculate-btn:hover {
            background-color: #2980b9;
        }
        
        
        .plot-container {
            width: 100%;
            height: 400px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .error {
            color: #e74c3c;
            background-color: #fadbd8;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .values-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 12px;
            background-color: white;
        }
        
        .values-table th,
        .values-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        
        .values-table th {
            background-color: #34495e;
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .values-table tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .values-table tbody tr:hover {
            background-color: #e8f4fd;
        }
        
        .table-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .constants-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
            background-color: #f8f9fa;
        }
        
        .constants-table th,
        .constants-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        
        .constants-table th {
            background-color: #27ae60;
            color: white;
            font-weight: bold;
        }
        
        .toggle-btn {
            background-color: #95a5a6;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 14px;
        }
        
        .toggle-btn:hover {
            background-color: #7f8c8d;
        }
        
        .toggle-btn.active {
            background-color: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Magnetic Field Calculation and Plotting</h1>
        
        <div class="input-section">
            <div class="input-group">
                <label for="od_mm">OD_mm:</label>
                <input type="number" id="od_mm" step="0.001" placeholder="Enter OD value (mm)">
            </div>
            
            <div class="input-group">
                <label for="t_mm">t_mm:</label>
                <input type="number" id="t_mm" step="0.001" placeholder="Enter t value (mm)">
            </div>
            
            <div class="input-group">
                <label for="x_mm">x_mm:</label>
                <input type="number" id="x_mm" step="0.001" placeholder="Enter x value (mm)">
            </div>
            
            <div class="input-group">
                <label for="y_mm">y_mm:</label>
                <input type="number" id="y_mm" step="0.001" placeholder="Enter y value (mm)">
            </div>
            
            <div class="input-group">
                <label for="z_mm">z_mm:</label>
                <input type="number" id="z_mm" step="0.001" placeholder="Enter z value (mm)">
            </div>
        </div>
        
        <button class="calculate-btn" onclick="calculateAndPlot()">Calculate and Plot</button>
        
        <div id="error-message"></div>
        

    </div>
    
    <div class="container" id="values-container" style="display: none;">
        <h2>Calculated Values</h2>
        
        <div>
            <button class="toggle-btn active" onclick="showConstants()">Show Constants</button>
            <button class="toggle-btn" onclick="showAllValues()">Show All Values (360 rows)</button>
        </div>
        
        <div id="constants-section">
            <h3>Constants and Basic Values</h3>
            <table class="constants-table" id="constants-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Value</th>
                        <th>Unit</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody id="constants-tbody">
                </tbody>
            </table>
        </div>
        
        <div id="all-values-section" style="display: none;">
            <h3>All Calculated Values by Angle</h3>
            <div class="table-container">
                <table class="values-table" id="values-table">
                    <thead>
                        <tr>
                            <th>angle degree</th>
                            <th>m_dot_Rhat</th>
                            <th>Bx_T</th>
                            <th>By_T</th>
                            <th>Bz_T</th>
                            <th>F</th>
                            <th>Bx_Gauss</th>
                            <th>By_Gauss</th>
                            <th>Bz_Gauss</th>
                        </tr>
                    </thead>
                    <tbody id="values-tbody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="container" id="plots-container" style="display: none;">
        <h2>Magnetic Field Plots</h2>
        
        <h3>Bx_Gauss vs Angle (0-360°)</h3>
        <div id="bx-plot" class="plot-container"></div>
        
        <h3>By_Gauss vs Angle (0-360°)</h3>
        <div id="by-plot" class="plot-container"></div>
        
        <h3>Bz_Gauss vs Angle (0-360°)</h3>
        <div id="bz-plot" class="plot-container"></div>
    </div>

    <script>
        function calculateAndPlot() {
            // Get input values
            const OD_mm = parseFloat(document.getElementById('od_mm').value);
            const t_mm = parseFloat(document.getElementById('t_mm').value);
            const x_mm = parseFloat(document.getElementById('x_mm').value);
            const y_mm = parseFloat(document.getElementById('y_mm').value);
            const z_mm = parseFloat(document.getElementById('z_mm').value);
            
            // Validate input
            if (isNaN(OD_mm) || isNaN(t_mm) || isNaN(x_mm) || isNaN(y_mm) || isNaN(z_mm)) {
                showError('Please enter all required values!');
                return;
            }
            
            clearError();
            
            try {
                // Calculate basic values
                const r_m = OD_mm / 1000 / 2;
                const t_m = t_mm / 1000;
                const Br_T = 1.45;
                const x_m = x_mm / 1000;
                const y_m = y_mm / 1000;
                const z_m = z_mm / 1000;
                const mu0 = 4 * Math.PI * 0.0000001;
                const m0 = Br_T / mu0 * Math.PI * Math.pow(r_m, 2) * t_m;
                const R_m = Math.sqrt(Math.pow(x_m, 2) + Math.pow(y_m, 2) + Math.pow(z_m, 2));
                
                // Check R_m is not zero
                if (R_m === 0) {
                    showError('R_m value cannot be zero. Please check x, y, z values!');
                    return;
                }
                
                // Arrays to store results
                const angles = [];
                const Bx_Gauss = [];
                const By_Gauss = [];
                const Bz_Gauss = [];
                const L = [];
                const M = [];
                const N = [];
                
                // Calculate for each angle from 0 to 360 degrees
                for (let angle = 0; angle < 361; angle++) {
                    const angleRad = angle * Math.PI / 180;
                    
                    // Calculate m_dot_Rhat
                    const m_dot_Rhat = (m0 * Math.cos(angleRad) * x_m + m0 * Math.sin(angleRad) * y_m) / R_m;
                    
                    // Calculate Bx_T, By_T, Bz_T
                    const commonFactor = mu0 / (4 * Math.PI * Math.pow(R_m, 5));
                    const Bx_T = commonFactor * (3 * x_m * m_dot_Rhat * R_m - m0 * Math.cos(angleRad) * Math.pow(R_m, 2));
                    const By_T = commonFactor * (3 * y_m * m_dot_Rhat * R_m - m0 * Math.sin(angleRad) * Math.pow(R_m, 2));
                    const Bz_T = commonFactor * (3 * z_m * m_dot_Rhat * R_m);
                    
                    // Convert to Gauss
                    angles.push(angle);
                    Bx_Gauss.push(Bx_T * 10000);
                    By_Gauss.push(By_T * 10000);
                    Bz_Gauss.push(Bz_T * 10000);
                    
                    // Store L, M, N for F calculation
                    L.push(Bx_T);
                    M.push(By_T);
                    N.push(Bz_T);
                }
                
                // Calculate F array (SQRT(Bx_T^2 + By_T^2 + Bz_T^2)) for each angle
                const F = [];
                for (let i = 0; i < 361; i++) {
                    const value = Math.sqrt(Math.pow(L[i], 2) + Math.pow(M[i], 2) + Math.pow(N[i], 2));
                    F.push(value);
                }
                

                
                // Create values table
                createValuesTable(r_m, t_m, Br_T, x_m, y_m, z_m, mu0, m0, R_m, angles, L, M, N, F, Bx_Gauss, By_Gauss, Bz_Gauss);
                
                // Show values container
                document.getElementById('values-container').style.display = 'block';
                
                // Plot graphs
                plotGraph('bx-plot', angles, Bx_Gauss, 'Bx_Gauss', '#e74c3c');
                plotGraph('by-plot', angles, By_Gauss, 'By_Gauss', '#2ecc71');
                plotGraph('bz-plot', angles, Bz_Gauss, 'Bz_Gauss', '#3498db');
                
                // Show plots container
                document.getElementById('plots-container').style.display = 'block';
                
            } catch (error) {
                showError('An error occurred during calculation: ' + error.message);
            }
        }
        
        function plotGraph(containerId, x, y, title, color) {
            const trace = {
                x: x,
                y: y,
                type: 'scatter',
                mode: 'lines',
                name: title,
                line: {
                    color: color,
                    width: 2
                }
            };
            
            const layout = {
                title: {
                    text: title + ' vs Angle',
                    font: { size: 16 }
                },
                xaxis: {
                    title: 'Angle (degrees)',
                    showgrid: true
                },
                yaxis: {
                    title: title,
                    showgrid: true
                },
                showlegend: false,
                margin: { t: 50, r: 50, b: 50, l: 80 }
            };
            
            const config = {
                responsive: true,
                displayModeBar: true,
                modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d']
            };
            
            Plotly.newPlot(containerId, [trace], layout, config);
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.innerHTML = '<div class="error">' + message + '</div>';
        }
        
        function clearError() {
            document.getElementById('error-message').innerHTML = '';
        }
        
        function createValuesTable(r_m, t_m, Br_T, x_m, y_m, z_m, mu0, m0, R_m, angles, L, M, N, F, Bx_Gauss, By_Gauss, Bz_Gauss) {
            // Create constants table
            const constantsData = [
                ['r_m', r_m.toExponential(9), 'm', 'Magnet radius'],
                ['t_m', t_m.toExponential(9), 'm', 'Magnet thickness'],
                ['Br_T', Br_T.toFixed(9), 'T', 'Residual magnetic flux density'],
                ['x_m', x_m.toExponential(9), 'm', 'X coordinate'],
                ['y_m', y_m.toExponential(9), 'm', 'Y coordinate'],
                ['z_m', z_m.toExponential(9), 'm', 'Z coordinate'],
                ['mu0', mu0.toExponential(9), 'H/m', 'Permeability of free space'],
                ['m0', m0.toExponential(9), 'A⋅m²', 'Magnetic dipole moment'],
                ['R_m', R_m.toExponential(9), 'm', 'Total distance']
            ];
            
            const constantsTbody = document.getElementById('constants-tbody');
            constantsTbody.innerHTML = '';
            
            constantsData.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><strong>${row[0]}</strong></td>
                    <td>${row[1]}</td>
                    <td>${row[2]}</td>
                    <td>${row[3]}</td>
                `;
                constantsTbody.appendChild(tr);
            });
            
            // Store data for full table display
            window.tableData = {
                r_m, t_m, Br_T, x_m, y_m, z_m, mu0, m0, R_m, 
                angles, L, M, N, F, Bx_Gauss, By_Gauss, Bz_Gauss
            };
        }
        
        function showConstants() {
            document.getElementById('constants-section').style.display = 'block';
            document.getElementById('all-values-section').style.display = 'none';
            
            // Update button states
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }
        
        function showAllValues() {
            document.getElementById('constants-section').style.display = 'none';
            document.getElementById('all-values-section').style.display = 'block';
            
            // Update button states
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Create full table if not exists
            if (window.tableData && document.getElementById('values-tbody').children.length === 0) {
                createFullTable();
            }
        }
        
        function createFullTable() {
            const data = window.tableData;
            const tbody = document.getElementById('values-tbody');
            tbody.innerHTML = '';
            
            for (let i = 0; i < data.angles.length; i++) {
                const angle = data.angles[i];
                const angleRad = angle * Math.PI / 180;
                
                // Calculate m_dot_Rhat for this angle
                const m_dot_Rhat = (data.m0 * Math.cos(angleRad) * data.x_m + data.m0 * Math.sin(angleRad) * data.y_m) / data.R_m;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${angle}</td>
                    <td>${m_dot_Rhat.toExponential(9)}</td>
                    <td>${data.L[i].toExponential(9)}</td>
                    <td>${data.M[i].toExponential(9)}</td>
                    <td>${data.N[i].toExponential(9)}</td>
                    <td>${data.F[i].toExponential(9)}</td>
                    <td>${data.Bx_Gauss[i].toFixed(9)}</td>
                    <td>${data.By_Gauss[i].toFixed(9)}</td>
                    <td>${data.Bz_Gauss[i].toFixed(9)}</td>
                `;
                tbody.appendChild(tr);
            }
        }
        
        // Add event listeners for Enter key
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = document.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        calculateAndPlot();
                    }
                });
            });
        });
    </script>
</body>
</html>
